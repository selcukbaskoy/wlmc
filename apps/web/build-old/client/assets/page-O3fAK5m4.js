import{C as r}from"./PolymorphicComponent-9_vSQL7O.js";import{r as x,o as e,w as k}from"./chunk-PVWAREVJ-D_rE8Vsp.js";import{u as C,R as T}from"./layout-CWBhClkj.js";import{A as P}from"./layout-CHOcBlHj.js";import{u as f}from"./useQuery-hlGAr2h6.js";import{u as M}from"./useMutation-CJHwtqFu.js";import{S as K}from"./search-Z1iDdWJa.js";import{C as A}from"./crown-GjmdglVx.js";import{S as F}from"./shield-check-nwaqOUzs.js";import{S as O}from"./shield-jhLB3Iu4.js";import{U}from"./users-BGaJEnan.js";import"./react-CGZJyOp0.js";import"./x-Cg9-vnoo.js";import"./createLucideIcon-CYD35-38.js";import"./file-text-Dl61NW4K.js";import"./circle-help-BCyQsvte.js";import"./menu-CpMGlG8b.js";if(typeof window<"u"){const n={};globalThis.process??={};const l=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},n,l),{get(s,t){return t in s?s[t]:void 0},has(){return!0}})}function E({isOpen:n,onClose:l,user:s,availableRoles:t,onAssignRole:a,onRemoveRole:o}){return!n||!s?null:e.jsx(r,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",renderId:"render-2f8d7e9a",as:"div",children:e.jsxs(r,{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",renderId:"render-d59504ed",as:"div",children:[e.jsxs(r,{className:"text-lg font-medium text-gray-900 mb-4",renderId:"render-850dbcdb",as:"h3",children:[s.email," - Rol Yönetimi"]}),e.jsxs(r,{className:"space-y-4",renderId:"render-2620c969",as:"div",children:[e.jsxs(r,{renderId:"render-199b88e5",as:"div",children:[e.jsx(r,{className:"text-sm font-medium text-gray-700 mb-2",renderId:"render-493d38bc",as:"h4",children:"Mevcut Roller:"}),e.jsx(r,{className:"space-y-2",renderId:"render-835b5cb8",as:"div",children:s.roles?.length>0?s.roles.map(i=>e.jsxs(r,{className:"flex items-center justify-between p-2 bg-gray-50 rounded",renderId:"render-ad4ee30d",as:"div",children:[e.jsx(r,{className:"text-sm text-gray-900",renderId:"render-9511b0f6",as:"span",children:i.name}),e.jsx(r,{onClick:()=>o(s.id,i.id),className:"text-red-600 hover:text-red-800 text-sm",renderId:"render-bccd6462",as:"button",children:"Kaldır"})]},i.id)):e.jsx(r,{className:"text-sm text-gray-500",renderId:"render-8d86284e",as:"p",children:"Henüz rol atanmamış"})})]}),e.jsxs(r,{renderId:"render-a19cc773",as:"div",children:[e.jsx(r,{className:"text-sm font-medium text-gray-700 mb-2",renderId:"render-3f08bb4d",as:"h4",children:"Yeni Rol Ata:"}),e.jsx(r,{className:"space-y-2",renderId:"render-ae6163e0",as:"div",children:t?.filter(i=>!s.roles?.some(m=>m.id===i.id)).map(i=>e.jsx(r,{onClick:()=>a(s.id,i.id),className:"w-full text-left p-2 border border-gray-200 rounded hover:bg-gray-50 text-sm",renderId:"render-0d07e9fd",as:"button",children:i.name},i.id))})]})]}),e.jsx(r,{className:"flex justify-end space-x-3 mt-6",renderId:"render-ad9af2ca",as:"div",children:e.jsx(r,{onClick:l,className:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50",renderId:"render-2d38534b",as:"button",children:"Kapat"})})]})})}function q({users:n,onManageRoles:l}){const s=a=>a?.some(o=>o.name==="admin")?A:a?.some(o=>o.name==="editor")?F:a?.length>0?O:U,t=a=>{const o={admin:"bg-red-100 text-red-800",editor:"bg-blue-100 text-blue-800",author:"bg-green-100 text-green-800",viewer:"bg-gray-100 text-gray-800"};return a?.map(i=>e.jsx(r,{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${o[i.name]||"bg-gray-100 text-gray-800"}`,renderId:"render-4ba9614c",as:"span",children:i.name},i.id))};return e.jsx(r,{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",renderId:"render-51584cfe",as:"div",children:e.jsx(r,{className:"overflow-x-auto",renderId:"render-5b1700b6",as:"div",children:e.jsxs(r,{className:"min-w-full divide-y divide-gray-200",renderId:"render-b551792b",as:"table",children:[e.jsx(r,{className:"bg-gray-50",renderId:"render-62e1ed50",as:"thead",children:e.jsxs(r,{renderId:"render-871b27f3",as:"tr",children:[e.jsx(r,{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",renderId:"render-6b038b2c",as:"th",children:"Kullanıcı"}),e.jsx(r,{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",renderId:"render-c80b5275",as:"th",children:"Roller"}),e.jsx(r,{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",renderId:"render-8d3448b2",as:"th",children:"Kayıt Tarihi"}),e.jsx(r,{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",renderId:"render-f7bd680b",as:"th",children:"İşlemler"})]})}),e.jsx(r,{className:"bg-white divide-y divide-gray-200",renderId:"render-a822b7ca",as:"tbody",children:n?.map(a=>{const o=s(a.roles);return e.jsxs(r,{className:"hover:bg-gray-50",renderId:"render-1998dfb9",as:"tr",children:[e.jsx(r,{className:"px-6 py-4",renderId:"render-aa7b8a89",as:"td",children:e.jsxs(r,{className:"flex items-center",renderId:"render-382e4efa",as:"div",children:[e.jsx(r,{className:"flex-shrink-0",renderId:"render-c88951e4",as:"div",children:e.jsx(r,{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",renderId:"render-c2748012",as:"div",children:e.jsx(o,{size:20,className:"text-gray-600"})})}),e.jsxs(r,{className:"ml-4",renderId:"render-acbc1f5c",as:"div",children:[e.jsx(r,{className:"text-sm font-medium text-gray-900",renderId:"render-51b1d68a",as:"div",children:a.name||a.email}),e.jsx(r,{className:"text-sm text-gray-500",renderId:"render-5050b683",as:"div",children:a.email})]})]})}),e.jsx(r,{className:"px-6 py-4",renderId:"render-0c48910a",as:"td",children:e.jsx(r,{className:"flex flex-wrap gap-1",renderId:"render-8f75e1d4",as:"div",children:a.roles?.length>0?t(a.roles):e.jsx(r,{className:"text-sm text-gray-500",renderId:"render-226c49ff",as:"span",children:"Rol yok"})})}),e.jsx(r,{className:"px-6 py-4",renderId:"render-ce4eb104",as:"td",children:e.jsx(r,{className:"text-sm text-gray-900",renderId:"render-f1881d6b",as:"div",children:new Date(a.emailVerified||Date.now()).toLocaleDateString("tr-TR")})}),e.jsx(r,{className:"px-6 py-4",renderId:"render-409f1d28",as:"td",children:e.jsx(r,{onClick:()=>l(a),className:"text-blue-600 hover:text-blue-900 text-sm font-medium",renderId:"render-3d45de3e",as:"button",children:"Rolleri Yönet"})})]},a.id)})})]})})})}function D({pagination:n,onPageChange:l}){const{page:s,pages:t,total:a}=n;return e.jsxs(r,{className:"flex items-center justify-between",renderId:"render-55e955f6",as:"div",children:[e.jsxs(r,{className:"text-sm text-gray-700",renderId:"render-d1f3e021",as:"div",children:["Toplam ",a," kullanıcı"]}),e.jsxs(r,{className:"flex items-center space-x-2",renderId:"render-1ec6a9ab",as:"div",children:[e.jsx(r,{onClick:()=>l(s-1),disabled:s<=1,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",renderId:"render-7aee6b10",as:"button",children:"Önceki"}),e.jsxs(r,{className:"text-sm text-gray-700",renderId:"render-cabd211b",as:"span",children:["Sayfa ",s," / ",t]}),e.jsx(r,{onClick:()=>l(s+1),disabled:s>=t,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",renderId:"render-db951c11",as:"button",children:"Sonraki"})]})]})}function z(){const[n,l]=x.useState(""),[s,t]=x.useState(1),[a,o]=x.useState(null),[i,m]=x.useState(!1),g=C(),{data:u,loading:y,error:b}=f({queryKey:["admin-users",s,n],queryFn:async()=>{const d=new URLSearchParams({page:s.toString(),limit:"20"});n&&d.append("search",n);const c=await fetch(`/api/admin/users?${d}`);if(!c.ok)throw new Error("Failed to fetch users");return c.json()}}),{data:j}=f({queryKey:["admin-roles"],queryFn:async()=>{const d=await fetch("/api/admin/roles");if(!d.ok)throw new Error("Failed to fetch roles");return d.json()}}),h=M({mutationFn:async({user_id:d,role_id:c,action:R})=>{const p=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:d,role_id:c,action:R})});if(!p.ok){const S=await p.json();throw new Error(S.error||"Failed to manage role")}return p.json()},onSuccess:()=>{g.invalidateQueries(["admin-users"]),m(!1)}}),I=d=>{o(d),m(!0)},N=(d,c)=>{h.mutate({user_id:d,role_id:c,action:"assign"})},v=(d,c)=>{h.mutate({user_id:d,role_id:c,action:"remove"})},w=d=>{d.preventDefault(),t(1)};return e.jsxs(r,{className:"space-y-6",renderId:"render-7653d7ab",as:"div",children:[e.jsxs(r,{renderId:"render-fec3133a",as:"div",children:[e.jsx(r,{className:"text-2xl font-bold text-gray-900",renderId:"render-73688bc7",as:"h1",children:"Kullanıcı Yönetimi"}),e.jsx(r,{className:"text-gray-600",renderId:"render-6e7ef290",as:"p",children:"Kullanıcıları ve rollerini yönetin"})]}),e.jsx(r,{className:"bg-white p-4 rounded-lg border border-gray-200",renderId:"render-094e8f09",as:"div",children:e.jsxs(r,{onSubmit:w,className:"flex gap-4",renderId:"render-93fb11e5",as:"form",children:[e.jsx(r,{className:"flex-1",renderId:"render-0318a052",as:"div",children:e.jsxs(r,{className:"relative",renderId:"render-d5530263",as:"div",children:[e.jsx(K,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(r,{type:"text",placeholder:"E-posta veya isim ara...",value:n,onChange:d=>l(d.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",renderId:"render-2982b342",as:"input"})]})}),e.jsx(r,{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",renderId:"render-0f9f1e2a",as:"button",children:"Ara"})]})}),y?e.jsx(r,{className:"flex items-center justify-center py-12",renderId:"render-8e38d3d8",as:"div",children:e.jsx(r,{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600",renderId:"render-8ea909e8",as:"div"})}):b?e.jsx(r,{className:"bg-red-50 border border-red-200 rounded-lg p-4",renderId:"render-33958eee",as:"div",children:e.jsxs(r,{className:"text-red-600",renderId:"render-6872b7cf",as:"p",children:["Bir hata oluştu: ",b.message]})}):e.jsxs(e.Fragment,{children:[e.jsx(q,{users:u?.users||[],onManageRoles:I}),u?.pagination&&e.jsx(D,{pagination:u.pagination,onPageChange:t})]}),e.jsx(E,{isOpen:i,onClose:()=>m(!1),user:a,availableRoles:j,onAssignRole:N,onRemoveRole:v})]})}if(typeof window<"u"){const n={};globalThis.process??={};const l=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},n,l),{get(s,t){return t in s?s[t]:void 0},has(){return!0}})}const de=k(function(l){return e.jsx(T,{children:e.jsx(P,{children:e.jsx(z,{...l})})})});export{de as default};
