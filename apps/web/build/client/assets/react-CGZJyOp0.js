import{r as d}from"./chunk-PVWAREVJ-D_rE8Vsp.js";if(typeof window<"u"){const e={};globalThis.process??={};const n=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},e,n),{get(t,s){return s in t?t[s]:void 0},has(){return!0}})}class i extends Error{constructor(n,t){n instanceof Error?super(void 0,{cause:{err:n,...n.cause,...t}}):typeof n=="string"?(t instanceof Error&&(t={err:t,...t.cause}),super(n,t)):super(void 0,n),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",Error.captureStackTrace?.(this,this.constructor);const s=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${s}`}}class f extends i{}f.kind="signIn";class P extends i{}P.type="AdapterError";class $ extends i{}$.type="AccessDenied";class I extends i{}I.type="CallbackRouteError";class L extends i{}L.type="ErrorPageLoop";class T extends i{}T.type="EventError";class R extends i{}R.type="InvalidCallbackUrl";class M extends f{constructor(){super(...arguments),this.code="credentials"}}M.type="CredentialsSignin";class O extends i{}O.type="InvalidEndpoints";class D extends i{}D.type="InvalidCheck";class N extends i{}N.type="JWTSessionError";class W extends i{}W.type="MissingAdapter";class j extends i{}j.type="MissingAdapterMethods";class V extends i{}V.type="MissingAuthorize";class z extends i{}z.type="MissingSecret";class F extends f{}F.type="OAuthAccountNotLinked";class J extends f{}J.type="OAuthCallbackError";class H extends i{}H.type="OAuthProfileParseError";class X extends i{}X.type="SessionTokenError";class q extends f{}q.type="OAuthSignInError";class B extends f{}B.type="EmailSignInError";class G extends i{}G.type="SignOutError";class K extends i{}K.type="UnknownAction";class Q extends i{}Q.type="UnsupportedStrategy";class Y extends i{}Y.type="InvalidProvider";class Z extends i{}Z.type="UntrustedHost";class _ extends i{}_.type="Verification";class ee extends f{}ee.type="MissingCSRF";class te extends i{}te.type="DuplicateConditionalUI";class ne extends i{}ne.type="MissingWebAuthnAutocomplete";class se extends i{}se.type="WebAuthnVerificationError";class ie extends f{}ie.type="AccountNotLinked";class oe extends i{}oe.type="ExperimentalFeatureNotEnabled";if(typeof window<"u"){const e={};globalThis.process??={};const n=globalThis.process.env??{};globalThis.process.env=new Proxy(Object.assign({},e,n),{get(t,s){return s in t?t[s]:void 0},has(){return!0}})}var re=class extends i{},ae=class extends i{};async function C(e,n,t,s={}){const o=`${n.baseUrl}${n.basePath}/${e}`;try{const r={headers:{"Content-Type":"application/json",...s?.headers?.cookie?{cookie:s.headers.cookie}:{}},credentials:n.credentials};s?.body&&(r.body=JSON.stringify(s.body),r.method="POST");const a=await fetch(o,r),c=await a.json();if(!a.ok)throw c;return c}catch(r){return t.error(new re(r.message,r)),null}}function ce(){const[e,n]=d.useState(typeof navigator<"u"?navigator.onLine:!1);return d.useEffect(()=>{const t=new AbortController,{signal:s}=t,o=()=>{n(!0)},r=()=>{n(!1)};return window.addEventListener("online",o,{signal:s}),window.addEventListener("offline",r,{signal:s}),()=>{t.abort()}},[]),e}function S(){return Math.floor(Date.now()/1e3)}function m(e){const n="http://localhost:3000/api/auth",t=new URL(e?e.startsWith("http")?e:`https://${e}`:n),s=t.pathname==="/"?"/api/auth":t.pathname.replace(/\/$/,""),o=`${t.origin}${s}`;return{origin:t.origin,host:t.host,path:s,base:o,toString:()=>o}}var y={debug:console.debug,error:console.error,warn:console.warn},le=class w{static instance=null;config;constructor(){this.config=this.createDefaultConfig()}createDefaultConfig(){return{baseUrl:typeof window<"u"?m(window.location.origin).origin:"",basePath:typeof window<"u"?m(window.location.origin).path:"/api/auth",credentials:"same-origin",lastSync:0,session:null,fetchSession:async()=>{}}}static getInstance(){return w.instance||(w.instance=new w),w.instance}setConfig(n){this.config={...this.config,...n}}getConfig(){return this.config}initializeConfig(n){this.config.lastSync=n?S():0}},u=le.getInstance(),E=d.createContext(void 0);function de(e,n){const t=u.getConfig(),[s,o]=d.useState(n),[r,a]=d.useState(!e);return d.useEffect(()=>(t.fetchSession=async({event:c}={})=>{try{if(c==="storage"||!t.session){t.lastSync=S(),t.session=await U(),o(t.session);return}if(!c||!t.session||S()<t.lastSync)return;t.lastSync=S(),t.session=await U(),o(t.session)}catch(l){y.error(new ae(l.message,l))}finally{a(!1)}},t.fetchSession(),()=>{t.lastSync=0,t.session=null,t.fetchSession=async()=>{}}),[]),{session:s,setSession:o,loading:r,setLoading:a}}function ue(e,n){d.useEffect(()=>{const t=new AbortController,s=()=>{n&&document.visibilityState==="visible"&&e.fetchSession({event:"visibilitychange"})};return document.addEventListener("visibilitychange",s,{signal:t.signal}),()=>{t.abort()}},[n])}function fe(e,n,t){d.useEffect(()=>{if(n&&t){const s=setInterval(()=>{e.session&&e.fetchSession({event:"poll"})},n*1e3);return()=>{clearInterval(s)}}},[n,t])}async function U(e){const{baseUrl:n,basePath:t,credentials:s}=u.getConfig();return await C("session",{baseUrl:n,basePath:t,credentials:s},y,e)}async function x(){const{baseUrl:e,basePath:n,credentials:t}=u.getConfig();return(await C("csrf",{baseUrl:e,basePath:n,credentials:t},y))?.csrfToken??""}function pe(e){if(!E)throw new Error("React Context is unavailable in Server Components");const{children:n,refetchInterval:t,refetchWhenOffline:s=!0}=e,o=u.getConfig(),r=!!e.session;u.initializeConfig(r);const{session:a,setSession:c,loading:l,setLoading:b}=de(r,e.session??null);ue(o,e.refetchOnWindowFocus??!0);const v=ce();fe(o,t,s||v);const h=d.useMemo(()=>({data:a,status:l?"loading":a?"authenticated":"unauthenticated",update:async g=>{if(l||!a)return;b(!0);const p=await C("session",o,y,g?{body:{csrfToken:await x(),data:g}}:void 0);return b(!1),p&&c(p),p}}),[a,l,c]);return d.createElement(E.Provider,{value:h},n)}function we(e){if(!E)throw new Error("React Context is unavailable in Server Components");const n=u.getConfig(),t=d.useContext(E),{required:s,onUnauthenticated:o}={},r=s&&t?.status==="unauthenticated";return d.useEffect(()=>{if(r){const a=`${n.baseUrl}${n.basePath}/signin?${new URLSearchParams({error:"SessionRequired",callbackUrl:window.location.href})}`;o?o():window.location.href=a}},[r,o]),r?{data:t?.data,update:t?.update,status:"loading"}:t}async function he(){return C("providers",u.getConfig(),y)}async function ye(e,n={},t={}){const{callbackUrl:s=window.location.href,redirect:o=!0,...r}=n,a=u.getConfig(),c=`${a.baseUrl}${a.basePath}`,l=await he();if(!l){window.location.href=`${c}/error`;return}if(!e||!(e in l)){window.location.href=`${c}/signin?${new URLSearchParams({callbackUrl:s})}`;return}const b=l[e].type==="credentials";l[e].type;const v=`${c}/${b?"callback":"signin"}/${e}`,A=await x(),h=await fetch(`${v}?${new URLSearchParams(t)}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({...r,csrfToken:A,callbackUrl:s}),credentials:a.credentials}),g=await h.json();if(o){const k=g.url??s;window.location.href=k,k.includes("#")&&window.location.reload();return}const p=new URL(g.url).searchParams.get("error");return h.ok&&await a.fetchSession?.({event:"storage"}),{error:p,status:h.status,ok:h.ok,url:p?null:g.url}}async function be(e){const{callbackUrl:n=window.location.href,redirect:t=!0}=e??{},s=u.getConfig(),o=await x(),a=await(await fetch(`${s.baseUrl}${s.basePath}/signout`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({csrfToken:o,callbackUrl:n}),credentials:s.credentials})).json();if(t){const c=a.url??n;window.location.href=c,c.includes("#")&&window.location.reload();return}return await s.fetchSession?.({event:"storage"}),a}export{pe as S,be as a,ye as s,we as u};
